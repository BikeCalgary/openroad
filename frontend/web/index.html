<!DOCTYPE html>
<html>
  <head>
    <title>Plot your bike path</title>
    <link rel="stylesheet" type="text/css" href="jquery.jqplot.min.css" />
    <link rel="stylesheet" type="text/css" href="jquery-ui-1.8.19.custom.css" />
    <link href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700" rel="stylesheet" type="text/css" />

    <style type="text/css">
      html, body {
        width: 950px;
        margin: 0 auto;
        padding: 0;
        font-size: 20px; /* makes math easy */
      }

      * {
        font-family: 'PT Sans Narrow', sans-serif;
      }

      div.forms {
        position: relative;
      }

      div.origin-destination, form#mode {
        color: #223b5d;
        margin-bottom: .25em;
      }

      div.origin-destination h2, form#mode h2 {
        font-weight: normal;
        font-size: 1.2em;
        margin: 0;
        padding: 0;
      }

      form.origin-destination {
        margin: 0;
        padding: 0;
        position: relative;
      }

      form.origin-destination label {
        color: #a1cde5;
        float: left;
        width: 3em;
      }

      form.origin-destination div.status, form.origin-destination div.error {
        color: red;
        position: absolute;
        left: 25em;
        top: 2px;
        font-size: .8em;
        line-height: 1.55;
        margin-left: -8em;
        text-align: right;
        width: 8em;
      }

      form.origin-destination input.text {
        border: 2px solid #223b5d;
        background: #f9f298;
        padding-left: 5px;
        padding-right: 5px;
        width: 25em;
      }

      form.origin-destination a {
        text-decoration: none;
        color: #223b5d;
        font-size: .8em;
        line-height: 1.25;
      }

      form.origin-destination a.clicking {
        color: #a1cde5;
      }

      form#mode {
        position: absolute;
        right: 0;
        top: 0;
        width: 13em;
      }

      form#mode input {
        display: none;
      }

      form#mode label {
        padding-left: 22px;
        min-height: 18px;
        margin-left: .5em;
        cursor: pointer;
      }

      form#mode label.selected {
        font-weight: bold;
      }

      form#mode label.bicycling {
        background: url('./icons/icon-bicycling.png') no-repeat left center;
      }

      form#mode label.driving {
        background: url('./icons/icon-driving.png') no-repeat left center;
      }

      form#mode label.both {
        background: url('./icons/icon-both.png') no-repeat left center;
      }

      div#map {
        width: 100%;
        height: 400px;
      }

      ul#legend {
        display: block;
        margin: 0;
        padding: 2px 0 8px;
        text-align: center;
        height: 33px;
        line-height: 33px;
        border-bottom: 2px solid #f9f298;
        color: #4d4d4d;
        list-style: none;
      }

      ul#legend li {
        display: inline-block;
        font-size: .8em;
        height: 33px;
        vertical-align: middle;
        margin: 0 .5em;
      }

      ul#legend img, ul#legend span {
        display: inline-block;
        vertical-align: middle;
        padding-right: .2em;
      }

      div#details {
        margin-top: .5em;
        position: relative;
        color: #223b5d;
        padding-top: 5.5em;
      }

      div#details h2 {
        font-size: 1em;
        font-weight: normal;
        margin: 0;
        padding: 0;
        line-height: 2;
        white-space: nowrap;
        text-align: center;
        line-height: 1;
      }

      div#details h2 a {
        color: #223b5d;
        text-decoration: none;
        display: block;
        padding-bottom: 83px;
      }

      div#details div.year, div#details div.chart, div#details div.data, div#details div.other-cities, div#details div.reset {
        position: absolute;
        top: 0;
      }

      div#details div.year {
        left: 0;
        width: 32%;
      }

      div#details div.chart {
        left: 32%;
        width: 17%;
      }

      div#details div.data {
        left: 49%;
        width: 17%;
      }

      div#details div.other-cities {
        border-left: 2px solid #f9f298;
        left: 66%;
        width: 17%;
      }

      div#details div.reset {
        left: 83%;
        width: 17%;
      }

      div#details div.year .slider {
        margin-top: 1.5em;
      }

      div#details div.year .value {
        text-align: center;
        margin-top: 2.5em;
      }

      .ui-corner-all {
        -moz-border-radius: .3em;
        -webkit-border-radius: .3em;
        -khtml-border-radius: .3em;
        border-radius: .3em;
      }

      .ui-slider-horizontal {
        height: 4px;
        background: #223b5d;
        border: none;
        border-top: .4em solid white;
        border-bottom: .4em solid white;
        position: absolute;
        left: .4em;
        right: .4em;
        margin: 0 4px 0 0;
        font-size: 1em;
        -moz-border-radius: 0;
        -webkit-border-radius: 0;
        -khtml-border-radius: 0;
        border-radius: 0;
      }

      .ui-slider .ui-slider-range {
        height: .8em;
        top: -.4em;
        font-size: 1em;
        border: none;
        margin-left: 2px;
        border-top: 2px solid #223b5d;
        border-bottom: 2px solid #223b5d;
        background: #a2cd34;
        z-index: 3;
      }

      .ui-slider .ui-slider-handle {
        height: .8em;
        top: -.4em;
        width: .8em;
        margin-left: -.4em;
        border: 2px solid #223b5d;
        background: #a2cd34;
      }

      .ui-slider > .ui-slider-handle {
        cursor: w-resize;
      }

      .ui-slider > .ui-slider-handle + .ui-slider-handle {
        cursor: e-resize;
      }

      div#details div.chart a {
        background: url(icons/accidents-by-year-small.png) no-repeat center bottom;
      }

      div#details div.data a {
        background: url(icons/accident-data-small.png) no-repeat center bottom;
      }

      div#details div.other-cities a {
        background: url(icons/choose-another-city-small.png) no-repeat center bottom;
      }

      div#details div.reset a {
        background: url(icons/reset-small.png) no-repeat center bottom;
      }

      div#worst-locations {
        border-top: 2px solid #f9f298;
        display: none;
      }

      div#worst-locations h2 {
        padding-top: .25em;
        text-align: left;
        line-height: 1.6;
      }

      div#worst-locations ul {
        margin: 0;
        padding: 0;
        list-style: none;
      }

      div#worst-locations li {
        float: left;
        width: 316px;
        margin: 0;
        padding: 0;
        font-size: .8em;
        color: #4d4d4d;
      }

      div#worst-locations li.top-spot-0, div#worst-locations li.top-spot-1 {
        padding-right: 1px;
      }

      div#worst-locations .image-container {
        position: relative;
        height: 0;
        overflow: hidden;
        padding-bottom: 56.25%;
        max-width: 640px;
      }

      div#worst-locations img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      ul#city {
        margin: .5em 0;
        padding: 0;
        list-style: none;
      }

      ul#city li {
        float: left;
        width: 150px;
        height: 90px;
        padding-left: 10px;
      }

      ul#city li.first {
        padding-left: 0;
      }

      ul#city a {
        display: block;
        height: 90px;
        line-height: 90px;
        font-size: 70px;
        text-align: center;
        font-weight: bold;
        text-transform: uppercase;
        text-decoration: none;
        color: white;
      }

      ul#city li.selected a {
        color: #f9f298;
      }

      ul#city a.vancouver {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=49.26901,-123.10065');
      }
      ul#city a.calgary {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=51.03783,-114.09467');
      }
      ul#city a.toronto {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=43.665122,-79.411213');
      }
      ul#city a.ottawa {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=45.372683,-75.664255');
      }
      ul#city a.montreal {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=45.517061,-73.564721');
      }
      ul#city a.halifax {
        background: url('http://maps.googleapis.com/maps/api/streetview?sensor=false&size=150x90&location=44.615891,-63.614783');
      }

      div#data-dialog {
        overflow: auto;
      }

      div#data-dialog table {
        border-collapse: collapse;
        border: none;
      }

      div#data-dialog th, div#data-dialog td {
        text-align: left;
        white-space: nowrap;
        padding: 2px 4px;
        font-size: .75em;
      }

      div#data-dialog td.id, div#data-dialog td.distance_along_path {
        text-align: right;
      }

      div#data-dialog .address {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="forms">
      <div class="origin-destination">
        <h2>Set your route</h2>
        <form id="origin" class="origin-destination">
          <label for="origin-text">Start</label>
          <input class="text" id="origin-text" type="text" placeholder="example: 99 1st Ave" />
          <div class="status" style="display: none;"></div>
          <div class="error" style="display: none;"></div>
          <a href="#">or choose from map</a>
        </form>
        <form id="destination" class="origin-destination">
          <label for="destination-text">Finish</label>
          <input class="text" id="destination-text" type="text" placeholder="example: 12 2nd St" />
          <div class="status" style="display: none;"></div>
          <div class="error" style="display: none;"></div>
          <a href="#">or choose from map</a>
        </form>
      </div>
      <form id="mode">
        <h2>Set your vehicle type</h2>
        <div class="options">
          <label class="bicycling selected"><input type="radio" name="mode" value="bicycling" checked="checked" />bike</label>
          <label class="driving"><input type="radio" name="mode" value="driving" />car</label>
          <label class="both"><input type="radio" name="mode" value="both" />both</label>
        </div>
      </form>
    </div>
    <div id="map"></div>
    <ul id="legend" style="display:none;">
      <li><img src="icons/marker-origin.png" alt="" /><img src="icons/marker-destination.png" alt="" /> Route marker</li>
      <li><span style="display:inline-block;width:2em;height:.3em;background:#a73438;">&nbsp;</span> Bike route</li>
      <li><span style="display:inline-block;width:2em;height:.3em;background:#0e3b5d;">&nbsp;</span> Car route</li>
      <li><img src="icons/marker-accident.png" alt="" /> Accident between a car and a bicycle</li>
      <li><img src="icons/marker-top-spot.png" alt="" /> Most accident-prone spot location</li>
    </ul>
    <div id="details" style="display:none;">
      <div class="year">
        <h2>Date range</h2>
        <div class="slider"></div>
        <div class="value"></div>
      </div>
      <div class="chart">
        <h2><a href="#">View results by year</a></h2>
      </div>
      <div class="data">
        <h2><a href="#">View accident reports</a></h2>
      </div>
      <div class="other-cities">
        <h2><a href="#">Explore another city</a></h2>
      </div>
      <div class="reset">
        <h2><a href="#">Reset map</a></h2>
      </div>

      <div id="worst-locations"></div>
    </div>
    <ul id="city">
      <li class="first"><a class="vancouver" href="#vancouver">VAN</a></li>
      <li><a class="calgary" href="#calgary">CGY</a></li>
      <li class="selected"><a class="toronto" href="#toronto">TOR</a></li>
      <li><a class="ottawa" href="#ottawa">OTT</a></li>
      <li><a class="montreal" href="#montreal">MTL</a></li>
      <li><a class="halifax" href="#halifax">HFX</a></li>
    </ul>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.7&sensor=true&key=AIzaSyDWrbWJ46ET44B2Z0UFdqsT3DbsZXKXuqU"></script>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="jquery-ui-1.8.19.custom.min.js"></script>
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="excanvas.min.js"></script><![endif]-->
    <script type="text/javascript" src="jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="markerclusterer.js"></script>
    <script type="text/javascript" src="app.js" charset="utf-8"></script>
    <script type="text/javascript">
      var mapDiv = document.getElementById('map');
      var map = new google.maps.Map(mapDiv, {
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: new google.maps.LatLng(0, 0),
        zoom: 1,
        mapTypeControl: false
      });

      var bikeLayer = new google.maps.BicyclingLayer();
      bikeLayer.setMap(map);

      var state = new State('toronto');

      var chartLink = $('#details .chart a')[0];
      var dataLink = $('#details .data a')[0];
      var worstLocationsDiv = document.getElementById('worst-locations');

      var manager = new Manager(map, state, chartLink, dataLink, worstLocationsDiv);

      $('form#mode').mode_form(state);
      $('form#origin').address_form('origin', state, map, function() { $('form#destination a').click(); });
      $('form#destination').address_form('destination', state, map);
      $('div.year div.slider').year_range_slider(state);
      $('form#origin a').click();

      $('div#details div.other-cities a').other_cities_a(state, $('ul#city'));

      $('div#details div.reset a').on('click', function(e) {
        e.preventDefault();
        state.setOrigin(undefined);
        state.setDestination(undefined);
        $('form#origin a').click();
      });

      state.onChange('accidents', function(accidents) {
        var $citySelector = $('ul#city');
        var $legend = $('ul#legend');
        var $details = $('div#details');
        if (accidents.bicycling === undefined && accidents.driving === undefined) {
          $legend.hide();
          $details.hide();
          $citySelector.show();
        } else {
          $legend.show();
          $details.show();
          $citySelector.hide();
        }
      });

      $('#city a').click(function(e) {
        e.preventDefault();
        $a = $(e.target);
        $li = $a.parent();
        $ul = $li.parent();
        $ul.find('li').removeClass('selected');
        $li.addClass('selected');
        state.setCity($a.attr('href').split(/\#/)[1])
      });
    </script>
  </body>
</html>
