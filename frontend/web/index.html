<!DOCTYPE html>
<html>
  <head>
    <title>Plot your bike path</title>
    <link rel="stylesheet" type="text/css" href="jquery.jqplot.min.css" />
    <link rel="stylesheet" type="text/css" href="jquery-ui-1.8.19.custom.css" />
    <link href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="app.css" />
  </head>
  <body>
    <div class="forms">
      <div class="origin-destination">
        <h2>Set your route</h2>
        <form id="origin" class="origin-destination">
          <label for="origin-text">Start</label>
          <input class="text" id="origin-text" type="text" placeholder="example: 99 1st Ave" />
          <div class="status" style="display: none;"></div>
          <div class="error" style="display: none;"></div>
          <a href="#">or choose from map</a>
        </form>
        <form id="destination" class="origin-destination">
          <label for="destination-text">Finish</label>
          <input class="text" id="destination-text" type="text" placeholder="example: 12 2nd St" />
          <div class="status" style="display: none;"></div>
          <div class="error" style="display: none;"></div>
          <a href="#">or choose from map</a>
        </form>
      </div>
      <form id="mode">
        <h2>Set your vehicle type</h2>
        <div class="options">
          <label class="bicycling selected"><input type="radio" name="mode" value="bicycling" checked="checked" />bike</label>
          <label class="driving"><input type="radio" name="mode" value="driving" />car</label>
          <label class="both"><input type="radio" name="mode" value="both" />both</label>
        </div>
      </form>
    </div>
    <div id="map"></div>
    <ul id="legend" style="display:none;">
      <li><img src="icons/marker-origin.png" alt="" /><img src="icons/marker-destination.png" alt="" /> Route marker</li>
      <li><span style="display:inline-block;width:2em;height:.3em;background:#a73438;">&nbsp;</span> Bike route</li>
      <li><span style="display:inline-block;width:2em;height:.3em;background:#0e3b5d;">&nbsp;</span> Car route</li>
      <li><img src="icons/marker-accident.png" alt="" /> Accident between a car and a bicycle</li>
      <li><img src="icons/marker-top-spot.png" alt="" /> Most accident-prone location</li>
    </ul>
    <div id="details" style="display:none;">
      <div class="year">
        <h2>Date range</h2>
        <div class="slider"></div>
        <div class="value"></div>
      </div>
      <div class="chart">
        <h2><a href="#">View results by year</a></h2>
      </div>
      <div class="data">
        <h2><a href="#">View accident reports</a></h2>
      </div>
      <div class="other-cities">
        <h2><a href="#">Explore another city</a></h2>
      </div>
      <div class="reset">
        <h2><a href="#">Reset map</a></h2>
      </div>

      <div id="worst-locations"></div>
    </div>
    <ul id="city">
      <li class="first"><a class="vancouver" href="#vancouver">VAN</a></li>
      <li><a class="calgary" href="#calgary">CGY</a></li>
      <li class="selected"><a class="toronto" href="#toronto">TOR</a></li>
      <li><a class="ottawa" href="#ottawa">OTT</a></li>
      <li><a class="montreal" href="#montreal">MTL</a></li>
      <li><a class="halifax" href="#halifax">HFX</a></li>
    </ul>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.7&sensor=true&key=AIzaSyDWrbWJ46ET44B2Z0UFdqsT3DbsZXKXuqU"></script>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="jquery-ui-1.8.19.custom.min.js"></script>
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="excanvas.min.js"></script><![endif]-->
    <script type="text/javascript" src="jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="markerclusterer.js"></script>
    <script type="text/javascript" src="app.js" charset="utf-8"></script>
    <script type="text/javascript">
      var mapDiv = document.getElementById('map');
      var map = new google.maps.Map(mapDiv, {
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: new google.maps.LatLng(0, 0),
        zoom: 1,
        mapTypeControl: false
      });

      var bikeLayer = new google.maps.BicyclingLayer();
      bikeLayer.setMap(map);

      var state = new State('toronto');

      var chartLink = $('#details .chart a')[0];
      var dataLink = $('#details .data a')[0];
      var worstLocationsDiv = document.getElementById('worst-locations');

      var manager = new Manager(map, state, chartLink, dataLink, worstLocationsDiv);

      $('form#mode').mode_form(state);
      $('form#origin').address_form('origin', state, map, function() { $('form#destination a').click(); });
      $('form#destination').address_form('destination', state, map);
      $('div.year div.slider').year_range_slider(state);
      $('form#origin a').click();

      $('div#details div.reset a, div#details div.other-cities a').on('click', function(e) {
        e.preventDefault();
        // When route disappears, city-selection pops up
        state.setOrigin(undefined);
        state.setDestination(undefined);
        $('form#origin a').click();
      });

      state.onChange('accidents', function(accidents) {
        var $citySelector = $('ul#city');
        var $legend = $('ul#legend');
        var $details = $('div#details');
        if (accidents.bicycling === undefined && accidents.driving === undefined) {
          $legend.hide();
          $details.hide();
          $citySelector.show();
        } else {
          $legend.show();
          $details.show();
          $citySelector.hide();
        }
      });

      $('#city a').click(function(e) {
        e.preventDefault();
        $a = $(e.target);
        $li = $a.parent();
        $ul = $li.parent();
        $ul.find('li').removeClass('selected');
        $li.addClass('selected');
        state.setCity($a.attr('href').split(/\#/)[1])
      });
    </script>
  </body>
</html>
